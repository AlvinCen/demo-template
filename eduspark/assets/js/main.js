(function(){
  const html=document.documentElement;const saved=localStorage.getItem('edu-theme');if(saved==='dark')html.classList.add('dark');
  document.addEventListener('click',e=>{const t=e.target.closest('[data-theme-toggle]');if(t){html.classList.toggle('dark');localStorage.setItem('edu-theme',html.classList.contains('dark')?'dark':'light');}});
  const ENR='edu_enrollments',PROG='edu_progress',WISHL='edu_wishlist';const get=k=>JSON.parse(localStorage.getItem(k)||'[]');const set=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
  const money=n=>'$'+(Math.round(n*100)/100).toFixed(2);
  const seed=[{id:'C-101',title:'JavaScript for Beginners',price:29,level:'Beginner',cat:'Development',lessons:12,hours:5.5,rating:4.7},{id:'C-102',title:'Figma UI Design Mastery',price:35,level:'Intermediate',cat:'Design',lessons:18,hours:7.0,rating:4.6},{id:'C-103',title:'Data Analysis with Python',price:49,level:'Intermediate',cat:'Data',lessons:20,hours:8.5,rating:4.8},{id:'C-104',title:'Public Speaking Essentials',price:19,level:'Beginner',cat:'Business',lessons:10,hours:3.0,rating:4.4}];
  const allCourses=()=>seed;
  function renderCatalog(){const wrap=document.querySelector('[data-catalog]');if(!wrap)return;const q=(document.querySelector('[name=q]')?.value||'').toLowerCase();const cat=(document.querySelector('[name=cat]')?.value||'');const lvl=(document.querySelector('[name=level]')?.value||'');const max=parseFloat(document.querySelector('[name=max]')?.value||'1e9');let list=allCourses().filter(c=>(!q||c.title.toLowerCase().includes(q))&&(!cat||c.cat===cat)&&(!lvl||c.level===lvl)&&c.price<=max);wrap.innerHTML=list.map(c=>{const enrolled=get(ENR).includes(c.id);const wish=get(WISHL).includes(c.id);return `<article class="card course"><img src="assets/img/placeholder/800x600.svg"/><div class="body"><div style="display:flex;justify-content:space-between;align-items:center"><strong>${c.title}</strong><span class="badge">${c.cat} • ${c.level}</span></div><div class="meta">★ ${c.rating} • ${c.lessons} lessons • ${c.hours}h</div><div style="display:flex;gap:8px;align-items:center;margin-top:8px"><div class="course price">${money(c.price)}</div><a class="btn ghost" href="course.html?id=${c.id}">Details</a>${enrolled?'<span class="badge">Enrolled</span>':`<button class="btn" data-enroll="${c.id}">Enroll</button>`}<button class="btn ghost" data-wish="${c.id}" title="Wishlist">${wish?'♥':'♡'}</button></div></div></article>`;}).join('')||'<p>No courses found.</p>';}
  document.querySelector('[data-filter]')?.addEventListener('input',renderCatalog);renderCatalog();
  document.addEventListener('click',e=>{const en=e.target.closest('[data-enroll]');if(en){const id=en.getAttribute('data-enroll');const s=new Set(get(ENR));s.add(id);set(ENR,[...s]);alert('Enrolled!');renderCatalog();renderDash();}const ws=e.target.closest('[data-wish]');if(ws){const id=ws.getAttribute('data-wish');const s=new Set(get(WISHL));s.has(id)?s.delete(id):s.add(id);set(WISHL,[...s]);renderCatalog();renderWishlist();}});
  function renderCourse(){const el=document.querySelector('[data-course]');if(!el)return;const params=new URLSearchParams(location.search);const id=params.get('id')||'C-101';const c=allCourses().find(x=>x.id===id)||seed[0];const enrolled=get(ENR).includes(c.id);el.innerHTML=`<div class="grid cols-2"><img src="assets/img/placeholder/1200x800.svg"/><div><h1>${c.title}</h1><div class="badge">${c.cat} • ${c.level}</div><p class="meta">★ ${c.rating} • ${c.lessons} lessons • ${c.hours} hours</p><div style="display:flex;gap:8px;align-items:center;margin-top:8px"><div class="course price" style="font-size:28px">${money(c.price)}</div>${enrolled?`<a class="btn" href="lesson.html?id=${c.id}&l=1">Continue</a>`:`<button class="btn" data-enroll="${c.id}">Enroll</button>`}<button class="btn ghost" data-wish="${c.id}">♡ Wishlist</button></div><hr style="margin:14px 0;border:0;border-top:1px solid var(--border)"/><div class="accordion"><details open><summary>What you'll learn</summary><ul><li>Core concepts with hands-on exercises</li><li>Real-world mini projects</li><li>Best practices & tips</li></ul></details><details><summary>Curriculum</summary><ol><li>Lesson 1: Introduction</li><li>Lesson 2: Fundamentals</li><li>Lesson 3: Project Setup</li></ol></details><details><summary>Instructor</summary><p>Alex – Senior Instructor with 8+ years experience.</p></details></div></div></div>`;}renderCourse();
  function renderLesson(){const wrap=document.querySelector('[data-lesson]');if(!wrap)return;const params=new URLSearchParams(location.search);const id=params.get('id')||'C-101';const cur=parseInt(params.get('l')||'1',10);const c=allCourses().find(x=>x.id===id)||seed[0];const lessons=Array.from({length:Math.max(3,c.lessons)},(_,i)=>i+1).slice(0,10);const rec=get(PROG).find(p=>p.id===id)||{id,done:[]};const pct=Math.round((rec.done.length/lessons.length)*100);function li(n){const active=n===cur;const done=rec.done.includes(n);return `<li style="display:flex;justify-content:space-between;gap:8px;align-items:center;${active?'font-weight:900':''}"><a href="lesson.html?id=${id}&l=${n}" style="text-decoration:none">${n}. ${c.title} — Part ${n}</a><button class="btn ghost" data-done="${n}">${done?'✓ Done':'Mark done'}</button></li>`;}wrap.innerHTML=`<div class="grid cols-2"><section class="card"><div class="body"><div class="badge">Lesson ${cur}</div><div style="aspect-ratio:16/9;border:1px solid var(--border);border-radius:12px;display:grid;place-items:center;background:var(--surface)">Video Placeholder</div><p>Lesson content: concise notes for part ${cur}.</p></div></section><aside class="card"><div class="body"><div class="kpi"><strong>Course progress</strong><span>${pct}%</span></div><div class="progress" style="margin:6px 0 12px"><span style="width:${pct}%"></span></div><ol style="display:grid;gap:6px;padding-left:18px">${lessons.map(li).join('')}</ol></div></aside></div>`;wrap.querySelectorAll('[data-done]').forEach(b=>{b.addEventListener('click',()=>{const n=parseInt(b.getAttribute('data-done'),10);const list=get(PROG);const rec=list.find(p=>p.id===id)||{id,done:[]};if(!rec.done.includes(n))rec.done.push(n);const i=list.findIndex(p=>p.id===id);if(i>-1)list[i]=rec;else list.push(rec);set(PROG,list);renderLesson();renderDash();});});}renderLesson();
  function renderWishlist(){const wrap=document.querySelector('[data-wishlist]');if(!wrap)return;const ids=get(WISHL);const items=allCourses().filter(c=>ids.includes(c.id));wrap.innerHTML=items.map(c=>`<tr><td>${c.title}</td><td>${c.cat}</td><td>${c.level}</td><td style="text-align:right">${money(c.price)}</td></tr>`).join('')||'<tr><td colspan="4">No items in wishlist.</td></tr>';}renderWishlist();
  function renderDash(){const s=document.querySelector('[data-student-courses]');if(s){const ids=get(ENR);const items=allCourses().filter(c=>ids.includes(c.id));s.innerHTML=items.map(c=>{const rec=get(PROG).find(p=>p.id===c.id)||{done:[]};const total=Math.min(10,c.lessons);const pct=Math.round((rec.done.length/total)*100);return `<article class="card"><div class="body"><div style="display:flex;justify-content:space-between;align-items:center"><strong>${c.title}</strong><span class="badge">${pct}%</span></div><div class="progress" style="margin:6px 0 10px"><span style="width:${pct}%"></span></div><a class="btn" href="lesson.html?id=${c.id}&l=1">Continue</a></div></article>`;}).join('')||'<p>No enrolled courses yet.</p>';}const i=document.querySelector('[data-instructor-courses]');if(i){i.innerHTML=allCourses().map(c=>`<tr><td>${c.id}</td><td>${c.title}</td><td>${c.cat}</td><td>${c.level}</td><td>${c.lessons}</td></tr>`).join('');}}renderDash();
  const quiz=document.querySelector('[data-quiz]');if(quiz){quiz.addEventListener('submit',e=>{e.preventDefault();const ans={q1:'b',q2:'c',q3:'a'};let score=0;Object.keys(ans).forEach(k=>{const v=quiz.querySelector(`[name=${k}]:checked`)?.value;if(v===ans[k])score++;});alert(`Score: ${score}/3`);});}
  document.addEventListener('submit',e=>{const f=e.target.closest('[data-ajax]');if(!f)return;e.preventDefault();alert('Thanks! (Demo)');f.reset();});
})();